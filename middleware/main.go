package main

import (
	"flag"
	"io/ioutil"
	"os"
	"gyg/middleware/app"
	"gyg/middleware/config"
	"gyg/middleware/services"
)

func main() {

	serviceLocator := services.NewLocator()
	logger := serviceLocator.Logger()
	logger.Info([]string{`
  ___  _  _  ___
 / __)( \/ )/ __)
( (_ \ )  /( (_ \
 \___/(__/  \___/
`}[0])
	logger.Warn([]string{`
████████╗██╗  ██╗███████╗    ███████╗████████╗ ██████╗ ██████╗ ███╗   ███╗    ██╗███████╗     ██████╗ ██████╗ ███╗   ███╗██╗███╗   ██╗ ██████╗
╚══██╔══╝██║  ██║██╔════╝    ██╔════╝╚══██╔══╝██╔═══██╗██╔══██╗████╗ ████║    ██║██╔════╝    ██╔════╝██╔═══██╗████╗ ████║██║████╗  ██║██╔════╝
   ██║   ███████║█████╗      ███████╗   ██║   ██║   ██║██████╔╝██╔████╔██║    ██║███████╗    ██║     ██║   ██║██╔████╔██║██║██╔██╗ ██║██║  ███╗
   ██║   ██╔══██║██╔══╝      ╚════██║   ██║   ██║   ██║██╔══██╗██║╚██╔╝██║    ██║╚════██║    ██║     ██║   ██║██║╚██╔╝██║██║██║╚██╗██║██║   ██║
   ██║   ██║  ██║███████╗    ███████║   ██║   ╚██████╔╝██║  ██║██║ ╚═╝ ██║    ██║███████║    ╚██████╗╚██████╔╝██║ ╚═╝ ██║██║██║ ╚████║╚██████╔╝██╗██╗██╗
   ╚═╝   ╚═╝  ╚═╝╚══════╝    ╚══════╝   ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝    ╚═╝╚══════╝     ╚═════╝ ╚═════╝ ╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚═╝╚═╝╚═╝
	`}[0])

	configPath := flag.String("config.path", "config/main.json", "Base config.")
	flag.Parse()

	data, err := ioutil.ReadFile(*configPath)
	if nil != err {
		logger.Error(err.Error())
		os.Exit(0)
	}

	config.Configuration, err = serviceLocator.LoadConfig(data)
	if err != nil {
		logger.Critical(err.Error())
		os.Exit(0)
	}

	server := app.NewServer(app.NewDispatcher(logger).Run())
	server.Start()

	logger.Success([]string{`
 _     _                         _                _                     _           _           _
| |   | |           _           | |              (_)     _             | |         | |         | |
| |__ | | ____  ___| |_  ____   | | ____    _   _ _  ___| |_  ____     | | _   ____| | _  _   _| |
|  __)| |/ _  |/___)  _)/ _  |  | |/ _  |  | | | | |/___)  _)/ _  |    | || \ / _  | || \| | | |_|
| |   | ( ( | |___ | |_( ( | |  | ( ( | |   \ V /| |___ | |_( ( | |_   | |_) | ( | | |_) ) |_| |_
|_|   |_|\_||_(___/ \___)_||_|  |_|\_||_|    \_/ |_(___/ \___)_||_( )  |____/ \_||_|____/ \__  |_|
                                                                  |/                     (____/
	`}[0])
}
